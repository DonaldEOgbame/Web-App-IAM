{% extends 'base.html' %}
{% block content %}
<div class="container glass" style="max-width:520px;margin:3em auto 0 auto;padding:2.5em 2em;">
  <h2 class="center" style="font-size:2em;margin-bottom:1.2em;background:linear-gradient(90deg,#6c63ff,#48c6ef);-webkit-background-clip:text;background-clip:text;-webkit-text-fill-color:transparent;">Upload Document</h2>
  <div class="alert alert-info" style="margin-bottom:1em;">
    <strong>Note:</strong> Uploading a document with the same title, category, and department will create a new version and archive the previous one. PDF files will be watermarked automatically for secure download.
  </div>
  <form method="post" enctype="multipart/form-data" style="margin-bottom:0;">
    {% csrf_token %}
    <div id="drop-zone" class="drop-zone" style="border:2px dashed #6c63ff;padding:2em;text-align:center;margin-bottom:1.2em;cursor:pointer;transition:background 0.2s;">
      <span id="drop-zone-text">Drag & drop a file here or click to select</span>
      <input type="file" id="id_file" name="file" style="display:none;">
      <div id="file-preview" style="margin-top:1em;"></div>
      <div id="progress-bar" class="progress-bar" style="display:none;margin-top:1em;height:8px;background:#e3e9f7;border-radius:4px;overflow:hidden;">
        <div id="progress-bar-inner" style="height:100%;width:0;background:linear-gradient(90deg,#6c63ff,#48c6ef);"></div>
      </div>
    </div>
    {% for field in form %}
      {% if field.name != 'file' %}
        <div class="form-group">{{ field.label_tag }}{{ field }}</div>
      {% endif %}
    {% endfor %}
    <button class="btn" type="submit" style="width:100%;font-size:1.1em;">&#11014; Upload</button>
  </form>
  <script>
    // Drag & drop logic
    const dropZone = document.getElementById('drop-zone');
    const fileInput = document.getElementById('id_file');
    const filePreview = document.getElementById('file-preview');
    const progressBar = document.getElementById('progress-bar');
    const progressBarInner = document.getElementById('progress-bar-inner');
    dropZone.addEventListener('click', () => fileInput.click());
    dropZone.addEventListener('dragover', e => { e.preventDefault(); dropZone.style.background = '#f8fafc'; });
    dropZone.addEventListener('dragleave', e => { e.preventDefault(); dropZone.style.background = ''; });
    dropZone.addEventListener('drop', e => {
      e.preventDefault();
      dropZone.style.background = '';
      if (e.dataTransfer.files.length) {
        fileInput.files = e.dataTransfer.files;
        showPreview(e.dataTransfer.files[0]);
      }
    });
    fileInput.addEventListener('change', e => {
      if (fileInput.files.length) showPreview(fileInput.files[0]);
    });
    function showPreview(file) {
      filePreview.innerHTML = `<strong>Selected:</strong> ${file.name} (${(file.size/1024).toFixed(1)} KB)`;
    }
    // Optionally, handle progress bar on AJAX upload
  </script>
</div>
{% endblock %}
