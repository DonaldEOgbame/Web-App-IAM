<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Emergency Access</title>
    <style>
        body{font-family:Arial, sans-serif;background:#f5f5f5;margin:0;padding:0;}
        .container{max-width:800px;margin:40px auto;background:#fff;padding:20px;border-radius:8px;box-shadow:0 2px 4px rgba(0,0,0,0.1);}
        h1{text-align:center;}
        form{margin-top:20px;padding:10px;border:1px solid #ddd;border-radius:4px;}
        label{display:block;margin-top:10px;}
        input[type="text"]{width:100%;padding:8px;border:1px solid #ccc;border-radius:4px;margin-top:5px;}
        button{margin-top:10px;padding:8px 12px;background:#007bff;color:#fff;border:none;border-radius:4px;cursor:pointer;}
        button:hover{background:#0056b3;}
        ul.messages{padding:0;list-style:none;}
        ul.messages li{margin-bottom:10px;padding:10px;border-radius:4px;}
        .error{background:#f8d7da;color:#721c24;}
        .success{background:#d4edda;color:#155724;}
        .warning{background:#fff3cd;color:#856404;}
        .token-box{background:#f0f2f5;padding:10px;border-radius:4px;margin-top:10px;font-family:monospace;}
    </style>
</head>
<body>
<div class="container">
    <h1>Emergency Access Dashboard</h1>
    {% if messages %}
    <ul class="messages">
        {% for m in messages %}
            <li class="{{ m.tags }}">{{ m }}</li>
        {% endfor %}
    </ul>
    {% endif %}

    <p>Emergency mode is currently <strong>{{ emergency_mode|yesno:"ACTIVE,INACTIVE" }}</strong>.</p>

    <form method="post" action="{% url 'core:activate_emergency' %}">
        {% csrf_token %}
        <h3>Activate Emergency Mode</h3>
        <label for="activate_reason">Reason</label>
        <input id="activate_reason" type="text" name="reason" required>
        <button type="submit">Activate</button>
    </form>

    <form method="post" action="{% url 'core:deactivate_emergency' %}" id="deactivateForm">
        {% csrf_token %}
        <h3>Deactivate Emergency Mode</h3>
        <button type="submit">Deactivate</button>
    </form>

    <form method="post" action="{% url 'core:generate_emergency_token' %}">
        {% csrf_token %}
        <h3>Generate Emergency Token</h3>
        <label for="username">Username</label>
        <input id="username" type="text" name="username" required>
        <label for="token_reason">Reason</label>
        <input id="token_reason" type="text" name="reason" required>
        <button type="submit">Generate Token</button>
    </form>

    {% if emergency_token %}
    <div class="token-box">
        Token for {{ token_username }}: <code>{{ emergency_token }}</code>
    </div>
    {% endif %}
</div>
<script>
(function(){
    const deactivate = document.getElementById('deactivateForm');
    if(deactivate){
        deactivate.addEventListener('submit', function(e){
            if(!confirm('Deactivate emergency mode?')) e.preventDefault();
        });
    }
})();
</script>
</body>
</html>
