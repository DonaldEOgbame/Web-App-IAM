<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>System Status</title>
    <style>
        body{font-family:Arial,sans-serif;background:#f5f5f5;margin:0;padding:0;}
        .container{max-width:800px;margin:40px auto;background:#fff;padding:20px;border-radius:8px;box-shadow:0 2px 4px rgba(0,0,0,0.1);}
        h1{text-align:center;}
        table{width:100%;border-collapse:collapse;margin-top:15px;}
        th,td{border:1px solid #ddd;padding:8px;text-align:left;}
        th{background:#f0f0f0;}
        .feature form{display:inline;}
        button{padding:6px 10px;background:#007bff;color:#fff;border:none;border-radius:4px;cursor:pointer;}
        button:hover{background:#0056b3;}
    </style>
</head>
<body>
<div class="container">
    <h1>System Status</h1>
    <p>Overall Status: <strong>{{ system_status.status|upper }}</strong></p>
    <p>Response Time: <span id="resp">{{ system_status.response_time_ms }} ms</span></p>
    <table>
        <thead>
            <tr><th>Service</th><th>Status</th><th>Required</th></tr>
        </thead>
        <tbody>
        {% for name, svc in system_status.services.items %}
            <tr>
                <td>{{ name }}</td>
                <td>{{ svc.status }}</td>
                <td>{{ svc.required }}</td>
            </tr>
        {% endfor %}
        </tbody>
    </table>
    <h2>Feature Flags</h2>
    <div class="feature">
        <p>FACE_API_ENABLED: {{ settings.FACE_API_ENABLED }}</p>
        <form method="post" action="{% url 'core:toggle_feature' %}">
            {% csrf_token %}
            <input type="hidden" name="feature" value="FACE_API_ENABLED">
            <input type="hidden" name="redirect_url" value="{{ request.path }}">
            <button type="submit">Toggle</button>
        </form>
    </div>
    <div class="feature">
        <p>RISK_ENGINE_BYPASS: {{ settings.RISK_ENGINE_BYPASS }}</p>
        <form method="post" action="{% url 'core:toggle_feature' %}">
            {% csrf_token %}
            <input type="hidden" name="feature" value="RISK_ENGINE_BYPASS">
            <input type="hidden" name="redirect_url" value="{{ request.path }}">
            <button type="submit">Toggle</button>
        </form>
    </div>
</div>
<script>
(function(){
    if({{ system_status.response_time_ms }} === 0){
        var ts = {{ system_status.timestamp }} * 1000;
        document.getElementById('resp').textContent = (Date.now() - ts) + ' ms';
    }
})();
</script>
</body>
</html>
