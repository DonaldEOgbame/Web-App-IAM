{% extends 'base.html' %}
{% block content %}
<div class="container glass" style="max-width:1000px;margin:3em auto 0 auto;padding:2.5em 2em;">
  <h2 class="center" style="font-size:2em;margin-bottom:1.2em;background:linear-gradient(90deg,#6c63ff,#48c6ef);-webkit-background-clip:text;background-clip:text;-webkit-text-fill-color:transparent;">Document Access Logs</h2>
  <form method="get" class="mb-3" style="display:flex;gap:1em;align-items:center;justify-content:center;margin-bottom:2em;">
    <input class="form-control" type="text" name="q" placeholder="Search logs..." value="{{ request.GET.q }}" style="max-width:320px;">
    <button class="btn" type="submit">&#128269; Search</button>
  </form>
  <div class="table-responsive">
    <table class="modern-table" style="border-radius:12px;overflow:hidden;">
      <thead>
        <tr style="background:linear-gradient(90deg,#e3e9f7,#f8fafc);">
          <th>Timestamp</th>
          <th>User</th>
          <th>Document</th>
          <th>Face Score</th>
          <th>Fingerprint</th>
          <th>Risk Score</th>
          <th>Blocked?</th>
          <th>IP</th>
          <th>Restore</th>
        </tr>
      </thead>
      <tbody>
        {% for log in logs %}
        <tr>
          <td>{{ log.timestamp }}</td>
          <td>{{ log.user|default:'System' }}</td>
          <td>{{ log.document }}
            {% if log.document.version > 1 %}<span class="badge badge-info ml-1">v{{ log.document.version }}</span>{% endif %}
            {% if log.document.deleted %}<span class="badge badge-secondary ml-1">Archived</span>{% endif %}
          </td>
          <td>
            {% if log.face_score %}
              <span class="badge badge-primary" title="Face Score">&#128100; {{ log.face_score|floatformat:2 }}</span>
            {% else %}-{% endif %}
          </td>
          <td>{% if log.fingerprint_status %}<span class="badge badge-success" title="Fingerprint Verified">&#128308;</span>{% else %}<span class="badge badge-danger" title="Fingerprint Not Verified">&#10060;</span>{% endif %}</td>
          <td>
            {% if log.risk_score %}
              <span class="badge badge-warning" title="Risk Score">&#9888; {{ log.risk_score|floatformat:2 }}</span>
            {% else %}-{% endif %}
          </td>
          <td>{% if log.was_blocked %}<span class="alert alert-danger">Yes</span>{% else %}<span class="alert alert-success">No</span>{% endif %}</td>
          <td>{{ log.ip_address|default:'-' }}</td>
          <td>
            {% if user.is_authenticated and user.role == 'ADMIN' and log.document.deleted %}
              <form method="post" action="{% url 'core:restore_document_version' log.document.id %}" style="display:inline;">
                {% csrf_token %}
                <button class="btn btn-sm btn-outline-success" type="submit" title="Restore this version">&#8634; Restore</button>
              </form>
            {% endif %}
          </td>
        </tr>
        {% empty %}
        <tr><td colspan="9" class="center">No logs found.</td></tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</div>
{% endblock %}
